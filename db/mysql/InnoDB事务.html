<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.46" />
    <meta name="theme" content="VuePress Theme Hope" />
    <link rel="icon" href="/images/favicon.ico"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>🎹 InnoDB事务 | liuxianzhishou</title><meta name="description" content="一步一罪化，一步一莲华">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.7120bfc5.css">
    <link rel="modulepreload" href="/assets/app.5aebcaaa.js"><link rel="modulepreload" href="/assets/InnoDB事务.html.93dcee3d.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/assets/InnoDB事务.html.1dd2c47b.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><!----><!----><span class="site-name hide-in-pad">liuxianzhishou</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="首页"><!---->首页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/proj/%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90.html" class="nav-link" aria-label="项目文档"><!---->项目文档<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Java"><span class="title"><!---->Java</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/java/basic/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1.html" class="nav-link" aria-label="Java 基础"><!---->Java 基础<!----></a></li><li class="dropdown-item"><a href="/java/collection/ArrayList.html" class="nav-link" aria-label="Java 集合"><!---->Java 集合<!----></a></li><li class="dropdown-item"><a href="/java/concurrency/synchronized.html" class="nav-link" aria-label="Java 并发 &amp; 多线程"><!---->Java 并发 &amp; 多线程<!----></a></li><li class="dropdown-item"><a href="/java/jvm/%E4%B8%80%E3%80%81%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA.html" class="nav-link" aria-label="JVM"><!---->JVM<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="数据库"><span class="title"><!---->数据库</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/db/mysql/MySQL%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html" class="nav-link" aria-label="MySQL"><!---->MySQL<!----></a></li><li class="dropdown-item"><a href="/db/redis/sds.html" class="nav-link" aria-label="Redis"><!---->Redis<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="框架中间件"><span class="title"><!---->框架中间件</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/frame/spring/Spring.html" class="nav-link" aria-label="spring"><!---->spring<!----></a></li><li class="dropdown-item"><a href="/frame/tomcat/tom.html" class="nav-link" aria-label="Tomcat"><!---->Tomcat<!----></a></li><li class="dropdown-item"><a href="/frame/mybatis/mybatis.html" class="nav-link" aria-label="MyBatis"><!---->MyBatis<!----></a></li><li class="dropdown-item"><a href="/frame/rpc/rpc.html" class="nav-link" aria-label="RPC"><!---->RPC<!----></a></li><li class="dropdown-item"><a href="/middleware/zookeeper/zo1.html" class="nav-link" aria-label="zookeeper"><!---->zookeeper<!----></a></li><li class="dropdown-item"><a href="/middleware/mq/rabbit.html" class="nav-link" aria-label="消息队列"><!---->消息队列<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="设计模式"><span class="title"><!---->设计模式</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/design/summary/%E6%80%BB%E8%A7%88.html" class="nav-link" aria-label="总览"><!---->总览<!----></a></li><li class="dropdown-item"><a href="/design/create/%E5%8D%95%E4%BE%8B.html" class="nav-link" aria-label="创建型"><!---->创建型<!----></a></li><li class="dropdown-item"><a href="/design/struct/%E9%80%82%E9%85%8D%E5%99%A8.html" class="nav-link" aria-label="结构型"><!---->结构型<!----></a></li><li class="dropdown-item"><a href="/design/behavior/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95.html" class="nav-link" aria-label="行为型"><!---->行为型<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="操作系统"><span class="title"><!---->操作系统</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/os/system/sys.html" class="nav-link" aria-label="操作系统"><!---->操作系统<!----></a></li><li class="dropdown-item"><a href="/os/linux/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.html" class="nav-link" aria-label="Linux"><!---->Linux<!----></a></li><li class="dropdown-item"><a href="/os/docker/docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.html" class="nav-link" aria-label="Docker"><!---->Docker<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="计算机网络"><span class="title"><!---->计算机网络</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/network/summary/basic.html" class="nav-link" aria-label="总览"><!---->总览<!----></a></li><li class="dropdown-item"><a href="/network/http/http.html" class="nav-link" aria-label="应用层"><!---->应用层<!----></a></li><li class="dropdown-item"><a href="/network/tcp/tcp.html" class="nav-link" aria-label="传输层"><!---->传输层<!----></a></li><li class="dropdown-item"><a href="/network/ip/ip.html" class="nav-link" aria-label="网络层"><!---->网络层<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/distributed/%E5%88%86%E5%B8%83%E5%BC%8F.html" class="nav-link" aria-label="分布式"><!---->分布式<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="算法"><span class="title"><!---->算法</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/algorithm/array/307.html" class="nav-link" aria-label="数组"><!---->数组<!----></a></li><li class="dropdown-item"><a href="/algorithm/list/460.html" class="nav-link" aria-label="链表"><!---->链表<!----></a></li><li class="dropdown-item"><a href="/algorithm/hash/532.html" class="nav-link" aria-label="哈希表"><!---->哈希表<!----></a></li><li class="dropdown-item"><a href="/algorithm/stack/218.html" class="nav-link" aria-label="栈 &amp; 队列"><!---->栈 &amp; 队列<!----></a></li><li class="dropdown-item"><a href="/algorithm/string/28.html" class="nav-link" aria-label="字符串"><!---->字符串<!----></a></li><li class="dropdown-item"><a href="/algorithm/tree/144%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%89%8D%E5%BA%8F%E9%81%8D%E5%8E%86.html" class="nav-link" aria-label="树"><!---->树<!----></a></li><li class="dropdown-item"><a href="/algorithm/backtrace/37%E8%A7%A3%E6%95%B0%E7%8B%AC.html" class="nav-link" aria-label="回溯"><!---->回溯<!----></a></li><li class="dropdown-item"><a href="/algorithm/dp/300%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97.html" class="nav-link" aria-label="动态规划"><!---->动态规划<!----></a></li><li class="dropdown-item"><a href="/algorithm/sort/327.html" class="nav-link" aria-label="排序"><!---->排序<!----></a></li><li class="dropdown-item"><a href="/algorithm/graph/126.html" class="nav-link" aria-label="图"><!---->图<!----></a></li><li class="dropdown-item"><a href="/algorithm/extra/685.html" class="nav-link" aria-label="补充"><!---->补充<!----></a></li><li class="dropdown-item"><a href="/algorithm/thread/1114.html" class="nav-link" aria-label="多线程"><!---->多线程<!----></a></li><li class="dropdown-item"><a href="/algorithm/offer/03.html" class="nav-link" aria-label="剑指 Offer"><!---->剑指 Offer<!----></a></li><li class="dropdown-item"><a href="/algorithm/comp/01.html" class="nav-link" aria-label="竞赛"><!---->竞赛<!----></a></li></ul></button></div></div></nav><!----></div><div class="navbar-right"><!----><div class="nav-item"><!----></div><!----><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/db/mysql/MySQL%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html" class="nav-link sidebar-link sidebar-page" aria-label="🎷 MySQL基本知识"><!---->🎷 MySQL基本知识<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/mysql/MySQL%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E.html" class="nav-link sidebar-link sidebar-page" aria-label="🎸 MySQL存储引擎"><!---->🎸 MySQL存储引擎<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/mysql/%E7%B4%A2%E5%BC%95.html" class="nav-link sidebar-link sidebar-page" aria-label="🎺 索引"><!---->🎺 索引<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/mysql/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html" class="nav-link sidebar-link sidebar-page" aria-label="🪕 性能优化"><!---->🪕 性能优化<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="🎹 InnoDB事务"><!---->🎹 InnoDB事务<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_1-四大特性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1. 四大特性"><!---->1. 四大特性<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_1-原子性-atomicity" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1) 原子性[Atomicity]"><!---->1) 原子性[Atomicity]<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_2-一致性-consistency" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2) 一致性[Consistency]"><!---->2) 一致性[Consistency]<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_3-隔离性-isolation" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3) 隔离性[Isolation]"><!---->3) 隔离性[Isolation]<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_4-持久性-durability" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4) 持久性[Durability]"><!---->4) 持久性[Durability]<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_2-并发下容易产生的问题" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2. 并发下容易产生的问题"><!---->2. 并发下容易产生的问题<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_1-脏读-dirty-read" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1) 脏读 [dirty read]"><!---->1) 脏读 [dirty read]<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_2-不可重复读-non-repeatable-read" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2) 不可重复读 [non-repeatable read]"><!---->2) 不可重复读 [non-repeatable read]<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_3-幻读-phantom-read" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3) 幻读 [phantom read]"><!---->3) 幻读 [phantom read]<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_3-隔离级别" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3. 隔离级别"><!---->3. 隔离级别<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_1-读未提交-read-uncommitted" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1) 读未提交 [Read Uncommitted]"><!---->1) 读未提交 [Read Uncommitted]<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_2-读提交-read-committed" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2) 读提交 [Read Committed]"><!---->2) 读提交 [Read Committed]<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_3-可重复读-repeatable-read" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3) 可重复读 [Repeatable Read]"><!---->3) 可重复读 [Repeatable Read]<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_4-串行化-serializable" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4) 串行化 [Serializable]"><!---->4) 串行化 [Serializable]<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_4-mvcc" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4. MVCC"><!---->4. MVCC<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_1-底层原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1) 底层原理"><!---->1) 底层原理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_2-针对-rc-rr-的不同实现" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2) 针对 RC &amp; RR 的不同实现"><!---->2) 针对 RC &amp; RR 的不同实现<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_3-优点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3) 优点"><!---->3) 优点<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_5-三大日志" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5. 三大日志"><!---->5. 三大日志<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_1-binlog" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1) binlog"><!---->1) binlog<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_2-redo-log" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2) redo log"><!---->2) redo log<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_3-undo-log" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3) undo log"><!---->3) undo log<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_6-其他日志" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6. 其他日志"><!---->6. 其他日志<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#error-log" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="error log"><!---->error log<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#slow-query-log" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="slow query log"><!---->slow query log<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#general-log" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="general log"><!---->general log<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/db/mysql/%E9%94%81.html" class="nav-link sidebar-link sidebar-page" aria-label="🥁 锁"><!---->🥁 锁<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/mysql/MySQL%E9%AB%98%E6%80%A7%E8%83%BD.html" class="nav-link sidebar-link sidebar-page" aria-label="🎻 MySQL高性能"><!---->🎻 MySQL高性能<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/mysql/sql.html" class="nav-link sidebar-link sidebar-page" aria-label="🔔 SQL 语句"><!---->🔔 SQL 语句<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/db/mysql/SQL%E8%AF%AD%E5%8F%A5.html" class="nav-link sidebar-link sidebar-page" aria-label="📯 SQL 语句 &amp; 练习"><!---->📯 SQL 语句 &amp; 练习<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->🎹 InnoDB事务</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="author-item">吞佛童子</span></span><span property="author" content="吞佛童子"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年6月9日</span><meta property="datePublished" content="2022-06-09T11:12:17.000Z"></span><span class="category-info" aria-label="分类🌈" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li class="category category7" role>db</li><meta property="articleSection" content="db"></ul></span><span aria-label="标签🏷" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li class="tag tag4" role>mysql</li></ul><meta property="keywords" content="mysql"></span><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 9 分钟</span><meta property="timeRequired" content="PT9M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_1-四大特性" class="router-link-active router-link-exact-active toc-link level2">1. 四大特性</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_1-原子性-atomicity" class="router-link-active router-link-exact-active toc-link level3">1) 原子性[Atomicity]</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_2-一致性-consistency" class="router-link-active router-link-exact-active toc-link level3">2) 一致性[Consistency]</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_3-隔离性-isolation" class="router-link-active router-link-exact-active toc-link level3">3) 隔离性[Isolation]</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_4-持久性-durability" class="router-link-active router-link-exact-active toc-link level3">4) 持久性[Durability]</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_2-并发下容易产生的问题" class="router-link-active router-link-exact-active toc-link level2">2. 并发下容易产生的问题</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_1-脏读-dirty-read" class="router-link-active router-link-exact-active toc-link level3">1) 脏读 [dirty read]</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_2-不可重复读-non-repeatable-read" class="router-link-active router-link-exact-active toc-link level3">2) 不可重复读 [non-repeatable read]</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_3-幻读-phantom-read" class="router-link-active router-link-exact-active toc-link level3">3) 幻读 [phantom read]</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_3-隔离级别" class="router-link-active router-link-exact-active toc-link level2">3. 隔离级别</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_1-读未提交-read-uncommitted" class="router-link-active router-link-exact-active toc-link level3">1) 读未提交 [Read Uncommitted]</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_2-读提交-read-committed" class="router-link-active router-link-exact-active toc-link level3">2) 读提交 [Read Committed]</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_3-可重复读-repeatable-read" class="router-link-active router-link-exact-active toc-link level3">3) 可重复读 [Repeatable Read]</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_4-串行化-serializable" class="router-link-active router-link-exact-active toc-link level3">4) 串行化 [Serializable]</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_4-mvcc" class="router-link-active router-link-exact-active toc-link level2">4. MVCC</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_1-底层原理" class="router-link-active router-link-exact-active toc-link level3">1) 底层原理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_2-针对-rc-rr-的不同实现" class="router-link-active router-link-exact-active toc-link level3">2) 针对 RC &amp; RR 的不同实现</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_3-优点" class="router-link-active router-link-exact-active toc-link level3">3) 优点</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_5-三大日志" class="router-link-active router-link-exact-active toc-link level2">5. 三大日志</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_1-binlog" class="router-link-active router-link-exact-active toc-link level3">1) binlog</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_2-redo-log" class="router-link-active router-link-exact-active toc-link level3">2) redo log</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_3-undo-log" class="router-link-active router-link-exact-active toc-link level3">3) undo log</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#_6-其他日志" class="router-link-active router-link-exact-active toc-link level2">6. 其他日志</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#error-log" class="router-link-active router-link-exact-active toc-link level3">error log</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#slow-query-log" class="router-link-active router-link-exact-active toc-link level3">slow query log</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/db/mysql/InnoDB%E4%BA%8B%E5%8A%A1.html#general-log" class="router-link-active router-link-exact-active toc-link level3">general log</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="innodb事务" tabindex="-1"><a class="header-anchor" href="#innodb事务" aria-hidden="true">#</a> 🎹 InnoDB事务</h1><blockquote><p>事务 [<code>Transaction</code>]：一系列操作，要么全部成功，要么全部失败，不允许出现中间状态</p></blockquote><h2 id="_1-四大特性" tabindex="-1"><a class="header-anchor" href="#_1-四大特性" aria-hidden="true">#</a> 1. 四大特性</h2><h3 id="_1-原子性-atomicity" tabindex="-1"><a class="header-anchor" href="#_1-原子性-atomicity" aria-hidden="true">#</a> 1) 原子性[Atomicity]</h3><ul><li>事务的最小工作单元，一个事务中的所有操作，要么全部完成，要么全部不完成，不会结束在中间某个环节，</li><li>若事务在执行过程中发生错误，会被回滚到事务开始前的状态，就像这个事务从来没有执行过一样</li><li>InnoDB 通过 <code>undo log</code> &amp; <code>redo log</code> 保证</li></ul><h3 id="_2-一致性-consistency" tabindex="-1"><a class="header-anchor" href="#_2-一致性-consistency" aria-hidden="true">#</a> 2) 一致性[Consistency]</h3><ul><li>事务开始和结束后，数据库的完整性不会因为事务的执行而受到破坏</li><li>是目的，原子性 + 隔离性 + 持久性 共同作用保证了一致性</li><li>InnoDB 通过 undo log 保证</li></ul><h3 id="_3-隔离性-isolation" tabindex="-1"><a class="header-anchor" href="#_3-隔离性-isolation" aria-hidden="true">#</a> 3) 隔离性[Isolation]</h3><ul><li>数据库允许多个并发事务同时对其数据进行读写和修改的能力</li><li>不同事务之间互不影响，MySQL 提供<code>四</code>种隔离级别</li><li>InnoDB 通过 <code>MVCC</code> &amp; <code>锁</code> 保证</li></ul><h3 id="_4-持久性-durability" tabindex="-1"><a class="header-anchor" href="#_4-持久性-durability" aria-hidden="true">#</a> 4) 持久性[Durability]</h3><ul><li>事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失</li><li>InnoDB 通过 <code>redo log</code> 保证</li></ul><hr><h2 id="_2-并发下容易产生的问题" tabindex="-1"><a class="header-anchor" href="#_2-并发下容易产生的问题" aria-hidden="true">#</a> 2. 并发下容易产生的问题</h2><h3 id="_1-脏读-dirty-read" tabindex="-1"><a class="header-anchor" href="#_1-脏读-dirty-read" aria-hidden="true">#</a> 1) <strong>脏读</strong> [<code>dirty read</code>]</h3><ul><li>场景： <ul><li><strong>事务A</strong> 读到了 <strong>事务B</strong> <strong>修改过的但没有提交</strong> 的数据，此时若 事务B 发生了<strong>回滚</strong>，那么 事务A 之前读到的数据就是过期的脏数据</li></ul></li></ul><h3 id="_2-不可重复读-non-repeatable-read" tabindex="-1"><a class="header-anchor" href="#_2-不可重复读-non-repeatable-read" aria-hidden="true">#</a> 2) <strong>不可重复读</strong> [<code>non-repeatable read</code>]</h3><ul><li>场景： <ul><li>在<mark>一个</mark>事务中，发生多次读取同一数据的情况，每次读取同一数据时出现<strong>数据不一致</strong>的情况</li></ul></li><li>侧重于 <code>update</code> 操作</li></ul><h3 id="_3-幻读-phantom-read" tabindex="-1"><a class="header-anchor" href="#_3-幻读-phantom-read" aria-hidden="true">#</a> 3) <strong>幻读</strong> [<code>phantom read</code>]</h3><ul><li>场景： <ul><li>在<mark>一个</mark>事务中，发生多次读取符合某种查询条件的<strong>记录数据</strong>，前后读取出现记录数据<strong>数量不一致</strong>的情况</li></ul></li><li>侧重于 <code>insert</code> | <code>delete</code></li></ul><hr><h2 id="_3-隔离级别" tabindex="-1"><a class="header-anchor" href="#_3-隔离级别" aria-hidden="true">#</a> 3. 隔离级别</h2><blockquote><p>查看事务的隔离级别命令: [MySQL 8.0.26]</p><p>SELECT @@transaction_isolation</p></blockquote><blockquote><p>修改事务的隔离级别命令:</p><p>SET [GLOBAL|SESSION] TRANSACTION ISOLATION LEVEL level;</p></blockquote><p><img src="/assets/img_1.27ff246b.png" alt="img_1.png"></p><h3 id="_1-读未提交-read-uncommitted" tabindex="-1"><a class="header-anchor" href="#_1-读未提交-read-uncommitted" aria-hidden="true">#</a> 1) 读未提交 [Read Uncommitted]</h3><ul><li>一个事务还没提交时，它做的变更就能被其他事务看到</li></ul><h3 id="_2-读提交-read-committed" tabindex="-1"><a class="header-anchor" href="#_2-读提交-read-committed" aria-hidden="true">#</a> 2) 读提交 [Read Committed]</h3><ul><li>一个事务只有被提交了，它的变更才能被其他事务看到</li><li>可通过 <code>MVCC</code> 保证</li><li>只会对<strong>索引</strong>增加 <code>Record Lock</code>，不会添加 <code>Gap Lock</code> 和 <code>Next-Key Lock</code>，<strong>并发度</strong>要比 RR 高很多</li><li>只支持 <code>row</code> 格式的 <code>binlog</code>，若指定了 <code>mixed</code> 作为 binlog 格式，在RC下，服务器会自动使用基于 <code>row</code> 格式的日志记录</li></ul><h3 id="_3-可重复读-repeatable-read" tabindex="-1"><a class="header-anchor" href="#_3-可重复读-repeatable-read" aria-hidden="true">#</a> 3) 可重复读 [Repeatable Read]</h3><ul><li>一个事务执行过程中，不论什么时刻读到的统一数据都是一致的</li><li>可通过 <code>MVCC</code> 保证，<strong>无需加锁</strong>影响性能</li><li><strong>InnoDB 默认隔离级别</strong></li><li>通过 <code>next-key lock </code>锁住记录之间的“间隙” &amp; 记录本身，防止其他事务在这个记录之间插入新的记录，可以<strong>避免幻读</strong>，但锁的粒度变大，死锁的概率也随之增大</li><li>同时支持 <code>statement</code>、<code>row</code> 以及 <code>mixed</code> 三种</li></ul><h3 id="_4-串行化-serializable" tabindex="-1"><a class="header-anchor" href="#_4-串行化-serializable" aria-hidden="true">#</a> 4) 串行化 [Serializable]</h3><ul><li>多个事务对同一记录进行读写操作时，若发生读写冲突，则相关事务会串行执行，必须前面的事务执行完成，当前事务才能执行</li><li>性能最差，却最安全</li><li>通过<strong>加锁</strong>保证</li></ul><blockquote><p>不同隔离级别下可能出现的并发问题：</p></blockquote><table><thead><tr><th></th><th>脏读</th><th>不可重复读</th><th>幻读</th></tr></thead><tbody><tr><td>RU</td><td>🐠</td><td>🐠</td><td>🐠</td></tr><tr><td>RC</td><td></td><td>🐋</td><td>🐋</td></tr><tr><td>RR</td><td></td><td></td><td>🐙</td></tr><tr><td>Serial</td><td></td><td></td><td></td></tr></tbody></table><hr><h2 id="_4-mvcc" tabindex="-1"><a class="header-anchor" href="#_4-mvcc" aria-hidden="true">#</a> 4. MVCC</h2><h3 id="_1-底层原理" tabindex="-1"><a class="header-anchor" href="#_1-底层原理" aria-hidden="true">#</a> 1) 底层原理</h3><h4 id="聚簇索引中-2-个隐藏列" tabindex="-1"><a class="header-anchor" href="#聚簇索引中-2-个隐藏列" aria-hidden="true">#</a> <strong>聚簇索引</strong>中 <mark>2</mark> 个隐藏列</h4><ul><li><strong>事务 id</strong> [<code>trx_id</code>] <ul><li><code>6</code> 字节，每次递增 1</li><li>当一个事务对某条聚族索引记录进行改动时，就会把该事务的事务 id 记录在 <code>trx_id</code> 隐藏列里</li></ul></li><li><strong>回滚指针</strong> [<code>roll_pointer</code>] <ul><li><code>7</code> 字节</li><li>每次对某条聚族索引记录进行改动时，都会把旧版本的记录写入到 <code>undo log</code> 中</li><li><code>roll_pointer</code> 指向这个旧版本记录</li></ul></li></ul><h4 id="read-view-4-个字段" tabindex="-1"><a class="header-anchor" href="#read-view-4-个字段" aria-hidden="true">#</a> <code>Read View</code> <mark>4</mark> 个字段</h4><ul><li><code>creator_trx_id</code><ul><li>创建该 Read View 的事务的事务 id</li></ul></li><li><code>m_ids</code><ul><li>创建 Read View 时当前数据库中<strong>活跃且未提交</strong>的事务 id 列表</li></ul></li><li><code>min_trx_id</code><ul><li><code>m_ids</code> 中<strong>最小</strong>事务 id 的事务 id</li></ul></li><li><code>max_trx_id</code><ul><li>创建 Read View 时当前数据库中应该给下一个事务分配的事务 id</li></ul></li></ul><h3 id="_2-针对-rc-rr-的不同实现" tabindex="-1"><a class="header-anchor" href="#_2-针对-rc-rr-的不同实现" aria-hidden="true">#</a> 2) 针对 RC &amp; RR 的不同实现</h3><h4 id="rc-的实现" tabindex="-1"><a class="header-anchor" href="#rc-的实现" aria-hidden="true">#</a> RC 的实现</h4><ul><li>在事务执行过程中，每次查询操作都会生成一个新的 <code>Read View</code>，只能解决脏读，会出现 不可重复读</li><li>在事务期间读取数据的时候，在找到数据后，先会将该记录的 <code>trx_id</code> 和该事务的 Read View 里的字段做个比较： <ul><li>若<code>trx_id</code> &lt;= <code>creator_trx_id</code> &amp;&amp; <code>trx_id</code> <strong>not in</strong> <code>m_ids</code><ul><li>说明这条记录的事务早就在该事务前提交过了，或是本事务自己修改的，该记录对该事务<strong>可见</strong></li></ul></li><li>若<code>trx_id</code> &gt; <code>creator_trx_id</code> &amp;&amp; <code>trx_id</code> <strong>not in</strong> <code>m_ids</code><ul><li>说明该事务读到的是和自己同时启动的另外一个事务修改的数据，但该事务不在 <code>m_ids</code> 列表里，说明已提交，则该记录对该事务<strong>可见</strong></li></ul></li><li>若<code>trx_id</code> &gt; <code>creator_trx_id</code> &amp;&amp; <code>trx_id</code> <strong>in</strong> <code>m_ids</code><ul><li>说明该事务读到的是和自己同时启动的另外一个事务修改的数据，但该事务还在 <code>m_ids</code> 列表里，说明还未提交，因此沿着 <code>undo log</code> 链条往下找旧版本的记录，直到满足上面 2 条情况</li></ul></li></ul></li></ul><h4 id="rr-的实现" tabindex="-1"><a class="header-anchor" href="#rr-的实现" aria-hidden="true">#</a> RR 的实现</h4><ul><li>启动事务时生成一个 <code>Read View</code>，然后<strong>整个事务期间</strong>用同一个初始创建的 Read View</li><li>在事务期间读取数据的时候，在找到数据后，先会将该记录的 <code>trx_id</code> 和该事务的 Read View 里的字段做个比较： <ul><li><code>trx_id</code> &lt;= <code>creator_trx_id</code> &amp;&amp; <code>trx_id</code> <strong>not in</strong> <code>m_ids</code><ul><li>说明这条记录的事务早就在该事务前提交过了，或是本事务自己修改的，该记录对该事务<strong>可见</strong></li></ul></li><li>若<code>trx_id</code> &gt; <code>creator_trx_id</code><ul><li>说明该事务读到的是和自己同时启动的另外一个事务修改的数据，此时不读取该条记录，而是沿着 <code>undo log</code> 链条往下找旧版本的记录，直到找到 <code>trx_id</code> &lt;= 该事务 id 的第一条记录</li></ul></li></ul></li></ul><h3 id="_3-优点" tabindex="-1"><a class="header-anchor" href="#_3-优点" aria-hidden="true">#</a> 3) 优点</h3><ul><li><code>MVCC</code> 使得数据库<strong>普通读</strong>不会对数据加锁，普通的 SELECT 请求<strong>不会加锁</strong>，提高了数据库的<strong>并发</strong>处理能力</li><li>普通读： <ul><li><code>select * from chap where id = 22</code></li></ul></li><li>当前读 [会加锁]： <ul><li><code>select * from chap where id = 22 lock in share mode</code></li><li><code>select * from chap where id = 22 for update</code></li></ul></li></ul><hr><h2 id="_5-三大日志" tabindex="-1"><a class="header-anchor" href="#_5-三大日志" aria-hidden="true">#</a> 5. 三大日志</h2><blockquote><p>WAL: 所有的修改都先被写入到日志中，然后再写磁盘</p></blockquote><h3 id="_1-binlog" tabindex="-1"><a class="header-anchor" href="#_1-binlog" aria-hidden="true">#</a> 1) binlog</h3><ol><li><strong>是什么？</strong></li></ol><ul><li>记录数据库 表结构 &amp; 表数据 的变更，例如 create | truncate | delete | alter | update | insert，不会记录 select</li></ul><ol start="2"><li><strong>是什么样式？</strong></li></ol><ul><li>逻辑日志</li><li><code>statement</code><ul><li>存储 sql 语句 + 事务 id + 执行时间</li><li>可能造成数据主从的不一致，例如使用了 <code>now()</code> <code>uuid()</code> 函数等</li><li>RR 隔离级别下支持</li></ul></li><li><code>row</code><ul><li>将 sql 语句做的修改转换成具体数值 + 事务 id + 执行时间</li><li>内容更长，体积更大，同步 + 恢复时 IO 消耗更大，需要借助 binlog 工具解析，但是结果准确</li></ul></li><li><code>mixed</code><ul><li><p>混合模式，MySQL会判断这条 SQL 语句是否可能引起数据不一致，如果是，就用 row 格式，否则就用 statement 格式</p></li><li><p>RR 隔离级别支持，RC 只能全部都是 row 格式</p></li><li><p><img src="data:image/png;base64,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" alt="img_7.png"></p></li></ul></li></ul><ol start="3"><li><strong>存在于哪些存储引擎中？</strong></li></ol><ul><li>MySQL <mark>所有</mark>存储引擎均支持</li></ul><ol start="4"><li><strong>什么情况下会用到？</strong></li></ol><ul><li><mark>数据恢复</mark> &amp; <mark>主从复制等数据同步操作</mark></li></ul><ol start="5"><li><strong>什么时候进行写入？</strong></li></ol><ul><li>事务<mark>提交</mark>时进行记录，写入成功说明该事务已经进入 <code>commit</code> 状态</li></ul><ol start="6"><li><strong>刷盘时机？</strong></li></ol><ul><li>参数： <code>sync_binlog</code></li><li>不同值下的策略： <ul><li><p>0 ： 写入文件系统，异步刷盘</p></li><li><p>1 ： 同步刷盘，提交事务就会刷盘</p></li><li><p>N [N &gt; 1] ： 累积 N 个事务后刷盘</p></li><li><p><img src="data:image/png;base64,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" alt="img_5.png"></p></li></ul></li></ul><ol start="7"><li><strong>文件大小？</strong></li></ol><ul><li><p>参数： <code>max_binlog_size</code> 可指定大小</p></li><li><p>大小达到上限，会生成一个新文件继续写入</p></li><li><p><img src="data:image/png;base64,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" alt="img_6.png"></p></li></ul><ol start="8"><li><strong>借助的内存空间？</strong></li></ol><ul><li><p><code>binlog cache</code>：每个线程独有</p></li><li><p>查看单个线程 binlog cache 的大小指令：<code>binlog_cache_size</code>，超过则会暂存磁盘</p></li><li><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWYAAAB/CAIAAABT6v+mAAAMMElEQVR4Xu2d64HjqhKEN64JyPE4GifjJG4GvgZJ0DTFo0eSrT5T35+RUAP9gJI8q1n/+9/GixBCRvyjZBBC5qFkEEIMUDIIIQYoGYQQA5QMQogBSgYhxAAlgxBigJJBCDFAySCEGKBkEEIMUDIIIQY+JxmP27+F20Nf+i3vIY8b7ECe959xmNj5E7LUHlP7Gc61jRU9Jg4zoC0xTee/RjuincwlpMnO7tN8TjIiRyzKzGnF28lU8TrOH5ulBTSm9hPZmAl7/EDJiBzi2FG0I9qJISEQlfmz+LJkvM9/7s98buO04n2CjvM6S0cwM+aMzZB3XLKknTDnOcSxozgkojNQmT8LIBlxG9/D8+D6I2QoFC37I86iNC6U1xNKInS+gzbORAomisXbnlzh7HGuatJ2bssws+E2SRpzvXq7p7nW5mQpZ0TdG84HKod1RLqxEY1Ej4n8zDbL2OslOPssOEw0e5HO3yREZlmPoBG2unC5SbcvzTgi7BIEFQ4lRNjJK/MTvdZxx2YWsGTEWcJs75Ce64PAI+8zUcGYv9R1IXQUq01e1+e5FTQXtCbKdVyOwljSz3C8ub6OgZ1YEWHCOcvYk21p2p4hXxHOS59Lo4gcO7uHnOsAXVKN66mMqzX7NKYwq2qulJaoxIVvIzf18ApVYm0J/TRkqV04WKPA4wbX5GCigHD2KBqSESZZHXpunx2Sg6llNVZOyUB0EvR5JsTWix9MJNO3DVwvw1t8RApDvxP/85NPG8gwi+pk1lZD7UF32VvZl6dr5InVd5SQDpVLoHGbSdo1Zp9mOkxUzY3ivNFNLDu5AgGNy7hGtSXy05KlduF02Kk1N1omOgmDZGxHaKcs6a7zrJOgz3MraEbIiVDx8HqKP5732/0R0o8CEKxh5riLkMQE7XFqL+rusreyL0/huk0UCekAMw/nDSPOzj5mOkxUzY3ivNVtycTERoIhtWoELSs/oWEfUDgddkDmbzm1TnQ0FskITfHXGzqsSIo3HCw9wlF9z1K9Q+pMWSgqWhUvzy6OQwy32y1G8/7Ze8h4LdZBXJKVGDMWep1UVVNQhom7i96htZMlfVkDkloDjVTjdhrr1nLOiCnM7Uw728xnPo5F61U1U4Qn2uoaIUvsp45tin6YAfGJJLWYJorB6DH2YZMMmc5km0jtqVXc0QvLZDxdaDgRLN7qZCSNHZqWE7gKNDrMPKSUTDF9AoeJumcvhZ+4e9G82sKEQOCYzcYcG5xqrlqC+TBhNaElLHEx0yAlxbB6yPKuWFtCP+ezBAsHw1SN26CzE0UW434yjADJ6PEwPhfJnBJyHmHH55VmXaf/XcIOPDYVJskoyzIDJYN8hmJt2hfqf5HlCeNYvXjNS8by2GaenpJBPkTxGB8XavlJZcW8hH/Ld2c/kVnJIISQFyWDEGKCkkEIMUDJIIQYoGQQQgx0JEO8skIuipcaefGTjKFkuMZLjbz4ScZQMlzjpUZe/CRjgGTo993TCyji5RT4Zj8bP9bopUZNP4lbgGRsPHhnuDxeauTFTzKGkuEaLzXy4icZQ8lwjZcaefGTjOlIBiGEaCgZhBADlAxCiAFKBiHEACWDEGKgIxn8Lff18VIjL36SMReQjPiG4Ggm7Ex62xBc+xPgtPya0/J5sJ/ki+yRjOo/9nz86v913iEZkcqNP0QnLQtVcsY1qrocwNBP4oY9kqEX13g1/p6OM2cscS900rJir9EZ+Rz7SbywSzLK1ZVXY3q+lY+4Ybgvfk86oPAojVnP/gzfz3QPzeuPbdjZic7j4BpFapHZzuQVW+wTfhIn7JMMuYjyamxeTwbl0NWeT+QrcYUvh6FRztRe4tinhBgzHFYubAPH3XFL34geFeRpmeg8Dq4ROoeSYY19xk/ig52SkVdRsXDiZlQ3ofZwes2i7rK3si9P4/4WdFYz3Axg9u3iGuIqGYaJzqOdVMF8jUrzZFdlyRz7lJ/EBXslY1tGcjWKY7H82sPVa7TuPi0ZxbbogzYDmh1LhmGi82gnVTJdI3SOsmSOfc5P4oHdkrGso5tYQ6FhPXnkR//OcOUaxd1F79DaX+KtiRRoM6DZsWQYJjqPdlILZmuUjYt8LpahvftBrsOkn8QB+yWjWEoLcRUuD6wX+Z50CJIMNHtDMuYnOg+UVMRcjXA+U2vxlei22Gf9JNfnAMkg38NLjbz4ScZQMlzjpUZe/CRj/oJkyA81ifHDtAe81MiLn2RMRzIIIURDySCEGKBkEEIMUDIIIQYoGYQQAx3J4G+5r4+XGnnxk4yhZLjGS428+EnGUDJc46VGXvwkY4Bk6L80SK89iVei8otQbPxGo5caNf0kbgGSsfHgneHyeKmRFz/JGEqGa7zUyIufZAwlwzVeauTFTzKmIxmEEKKhZBBCDFAyCCEGKBmEEAOUDEKIgY5k8Lfc18dLjbz4ScbslIy2TXzvr3Etk14XHFp+inZEO5lLiJHTvD0YL36SMV+WjIj4RoDv045oJ4aEzDPlbdLl4nXt/C731ijsFvLQ6VIaQBpPuTA2Ii44TTIM/A3JOAWbtyHR655/H64dRaPkkb4oCRnIebNlG5uf5MocIRnbDae+A4n+wbL+mvVIJRnij5nAjQ6MoBG26wCyt5yrssQRYZcgwrKbEPUXW9uV+YkCMzXKVImOBOd0q7CEiiBkBF7X2PwkV2a/ZGzrTd+M1PoUlnqNlpZynHwsFuZojerhFeVuqCyhnzIVg+nbWcMb9hW6SG2ZnSjSnq0gBvUPCy1yS0z9DN8N99h0TA6wDqr7Qib9JA7YLxnJRq29WjK2M71Ii/NGN7GIB1upcXnbNWKZQ0vkZziQ1L0yqy3InA47teZGy0SRmRoJQhJK+7oF1KNOfWzdCjN20+onuTBeJENu+f4KbQmBuG3mIaFl5Sc07LO4W+RPhx1QOTZPNFMjSTFB3veS0CqceKZvoA2s8xWhhFCrURRWP8l1OU4y9Mpp7f3qijqXSzYdlwu3C9oIYsy4l5fLyBL7qWOboh9mQHwiSS22iWZqJBCKAYN/AQ+E27IcdY16GP0kF2a/ZNQ3/7gaBXEUuBWhpRw1r0U5E1zrAjmsHrL4+nJgCf0sDXsbpIgIdU7tqrHYyqqtjbFGzRJVoiARxp3EdZnxk/hgp2R8ivLeJ26Wf5wr1aiHFz/JGI+SUerHn+ZKNerhxU8yxolklE/S8RFDPG9nPvbw8d3ZE5eqUQcvfpIxHckghBANJYMQYoCSQQgxQMkghBigZBBCDHQkg7/lvj5eauTFTzKGkuEaLzXy4icZQ8lwjZcaefGTjAGSUf39wfaKknh9Cf7tBxs/1uilRk0/iVuAZGw8eGe4PF5q5MVPMoaS4RovNfLiJxlDyXCNlxp58ZOM6UgGIYRoKBmEEAOUDEKIAUoGIcQAJYMQYoCSQQgxcFXJiK8NXvDf5Vz+a+Fz/isdCBnQkoz1Td+vbY8PSUaYZn4WbZ1fhx7tSGRZvV19ImGu+TgJaQMl4xH/03+9Qf6LWGLUtmIb6kuKgWVo+4RonD4H+QtAyVhAq7siPKinL3RP5uKvkWJTNVR3Aafbr+hSzNPuGhGzZ0vtkmxYGIyqXRbny1DNXI0sq+xUzEW0IB5eikHHsxAywQGSkVbx+jlf3jS3423XCJPB0MokboTlXNyzIesczTa59yccWdGKkXouGbi3NbBtue3uVs+N+Yh6uZmPlZA2B0iGsqn3+vvsufwC7nH7+QlfdL6e9oDDoCsV4bq6xa5Nid9JRmG49ExbVCuKYGzZ2+iB6YjA2IL+VUKm+JBkLD+e99v9cf+J+2c0Mh4GXGkR9qF4MMGbZXKsFwg0jr+N2h1nbNn0r2AcEW7d6F8lZIrjJSP2kxskHr8Pfm632/vwrRu32/AhQ89ul4yXtAy7DfaZ3ka1oWhRw8e9XZ43LKvrAwYRxWePqnVlPm+EtIGSsdzOMp2FBiRjaV1JWyE0LSfddf1arwui6bxkFN2znWyW+zO3D3Yt2NeNvktz4SKwFEnW4ypMEcnWyoVO2giZA0oGQfjec0DxCPkFlAwDfkUDfowh5BdQMmzgD2IXx6XT5KJQMgghBigZhBADlAxCiAFKBiHEACWDEGKAkkEIMUDJIIQYoGQQQgxQMgghBigZhBADlAxCiAFKBiHEACWDEGLg/2/oHFNHLhR/AAAAAElFTkSuQmCC" alt="img_4.png"></p></li></ul><ol start="9"><li><strong>过期清理？</strong></li></ol><ul><li><p>参数：<code>binlog_expire_logs_seconds</code></p></li><li><p><img src="/assets/img_8.8e983d3a.png" alt="img_8.png"></p></li></ul><h3 id="_2-redo-log" tabindex="-1"><a class="header-anchor" href="#_2-redo-log" aria-hidden="true">#</a> 2) redo log</h3><ol><li><strong>是什么？</strong></li></ol><ul><li>记录在某个页上做了什么修改</li></ul><ol start="2"><li><strong>是什么样式？</strong></li></ol><ul><li>物理日志，xxxx 页做了 xxx 修改</li><li>表空间号 + 数据页号 + 偏移量 + 修改数据长度 + 具体修改的数据</li></ul><ol start="3"><li><strong>存在于哪些存储引擎中？</strong></li></ol><ul><li>MySQL InnoDB 独有</li></ul><ol start="4"><li><strong>什么情况下会用到？</strong></li></ol><ul><li><mark>数据库的崩溃恢复</mark></li><li>当我们修改数据时，对内存数据进行了修改，但数据还未真正写到磁盘，此时若数据库挂了，就可以通过 redo log 对数据进行恢复</li></ul><ol start="5"><li><strong>什么时候进行写入？</strong></li></ol><ul><li><code>prepare</code>: 事务<mark>开始</mark>时，redo log 记录变更信息，执行过程中也不断记录，表明事务进入 <code>prepare</code> 状态</li><li><code>commit</code>: binlog 写入成功，事务进入 commit 状态， prepare ==&gt; commit</li></ul><ol start="6"><li><strong>刷盘时机？</strong></li></ol><ul><li>参数 <code>innodb_flush_log_at_trx_commit</code></li><li>不同值下的策略： <ul><li><code>0</code>：异步刷盘，后台每隔 1秒 刷盘，数据库挂掉则最多有 1秒 的数据丢失</li><li><code>1</code>：每次事务提交都进行刷盘 [default]，只要事务提交成功则不会有任何数据丢失</li><li><code>2</code>：写入文件系统缓存，异步每隔 1秒 刷盘，数据库挂掉不会有任何数据丢失 &amp; 文件系统挂掉最多有 1秒 的数据丢失</li></ul></li><li>特殊情况： <ul><li><p>当 redo log buffer 占用空间 &gt; innodb_log_buffer_size 总空间一半时，后台线程也会主动刷盘</p></li><li><p><img src="data:image/png;base64,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" alt="img_2.png"></p></li></ul></li></ul><ol start="7"><li><strong>文件大小？</strong></li></ol><ul><li>固定 == <code>4G</code>，环形数组形式</li><li>2 个重要属性： <ul><li><p><code>write pos</code></p></li><li><p><code>checkpoint</code> : 如果 <code>write pos</code> 追上 <code>checkpoint</code> ，表示日志文件组满了，这时候不能再写入新的 <code>redo log</code>，此时会出现 MySQL 偶尔变慢的情况</p></li><li><p><img src="/assets/img_3.a1959cdb.png" alt="img_3.png"></p></li></ul></li></ul><ol start="8"><li><strong>借助的内存空间？</strong></li></ol><ul><li><code>redo log buffer</code></li></ul><blockquote><p>两阶段提交</p></blockquote><ul><li>示意图： <ul><li><img src="/assets/img_9.3e8ff7bb.png" alt="img_9.png"></li></ul></li><li>作用： <ul><li>保证 redo log &amp; binlog 数据的一致性，若是主从复制则主库 &amp; 从库 数据一致</li></ul></li><li>判断逻辑： <ul><li>prepare 阶段，redo log 写入成功，查看 binlog 状态 <ul><li>undo log 完成 ==&gt; 事务执行</li><li>undo log 不完整 ==&gt; 事务回滚</li></ul></li><li>commit 阶段 <ul><li>binlog 肯定完成 ==&gt; 事务执行</li></ul></li></ul></li></ul><h3 id="_3-undo-log" tabindex="-1"><a class="header-anchor" href="#_3-undo-log" aria-hidden="true">#</a> 3) undo log</h3><ol><li><strong>是什么？</strong></li></ol><ul><li>记录数据的历史版本</li></ul><ol start="2"><li><strong>是什么样式？</strong></li></ol><ul><li>逻辑日志</li><li>insert 语句对应 undo log 的 delete 日志；update 语句对应 undo log 的 相反 update 日志；delete 语句对应 undo log 的 insert 日志</li></ul><ol start="3"><li><strong>存在于哪些存储引擎中？</strong></li></ol><ul><li>MySQL InnoDB 独有</li></ul><ol start="4"><li><strong>什么情况下会用到？</strong></li></ol><ul><li>事务失败后的回滚操作</li><li>MVCC</li></ul><ol start="5"><li>文件大小？</li></ol><ul><li>参数：<code>innodb_max_undo_log_size</code><ul><li><img src="/assets/img_10.2b1042e9.png" alt="img_10.png"></li></ul></li></ul><hr><h2 id="_6-其他日志" tabindex="-1"><a class="header-anchor" href="#_6-其他日志" aria-hidden="true">#</a> 6. 其他日志</h2><h3 id="error-log" tabindex="-1"><a class="header-anchor" href="#error-log" aria-hidden="true">#</a> error log</h3><ul><li>对 MySQL 的启动、运行、关闭过程进行了记录，可以帮助定位 MySQL 问题</li></ul><h3 id="slow-query-log" tabindex="-1"><a class="header-anchor" href="#slow-query-log" aria-hidden="true">#</a> slow query log</h3><ul><li>慢查询日志</li><li>记录执行时间超过 <code>long_query_time</code> 变量定义的时长的 查询语句</li></ul><h3 id="general-log" tabindex="-1"><a class="header-anchor" href="#general-log" aria-hidden="true">#</a> general log</h3><ul><li>记录所有对 MySQL 数据库请求的信息，无论请求是否正确执行</li></ul></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/10/10 下午8:43:48</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: liuxianzhishou@qq.com">liuxianzhishou</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/db/mysql/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html" class="nav-link prev" aria-label="🪕 性能优化"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->🪕 性能优化</div></a><a href="/db/mysql/%E9%94%81.html" class="nav-link next" aria-label="🥁 锁"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">🥁 锁<!----></div></a></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.5aebcaaa.js" defer></script>
  </body>
</html>
