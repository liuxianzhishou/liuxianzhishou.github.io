import{_ as n}from"./plugin-vue_export-helper.21dcd24c.js";import{o as s,c as a,e as p}from"./app.5aebcaaa.js";const t={},e=p(`<h1 id="locksupport" tabindex="-1"><a class="header-anchor" href="#locksupport" aria-hidden="true">#</a> \u2B55 LockSupport</h1><h2 id="_1-\u7C7B\u63CF\u8FF0" tabindex="-1"><a class="header-anchor" href="#_1-\u7C7B\u63CF\u8FF0" aria-hidden="true">#</a> 1. \u7C7B\u63CF\u8FF0</h2><ol><li>\u65B9\u6CD5 <code>park</code> \u548C <code>unpark</code> \u63D0\u4F9B\u4E86 <strong>\u963B\u585E</strong> &amp; <strong>\u89E3\u9664\u963B\u585E\u7EBF\u7A0B</strong> \u7684\u6709\u6548\u65B9\u6CD5\uFF0C <ul><li>\u8FD9\u4E9B\u7EBF\u7A0B\u4E0D\u4F1A\u9047\u5230\u5BFC\u81F4\u4E0D\u63A8\u8350\u4F7F\u7528\u7684\u65B9\u6CD5 Thread.suspend \u548C Thread.resume \u65E0\u6CD5\u7528\u4E8E\u6B64\u7C7B\u76EE\u7684\u7684\u95EE\u9898\uFF1A <ul><li>\u4E00\u4E2A\u8C03\u7528 park \u7684\u7EBF\u7A0B\u548C\u53E6\u4E00\u4E2A\u8BD5\u56FE\u89E3\u9664\u5B83\u7684\u7EBF\u7A0B\u4E4B\u95F4\u7684\u7ADE\u4E89\u7531\u4E8E\u8BB8\u53EF\uFF0C\u5C06\u4FDD\u6301\u6D3B\u529B\u3002</li></ul></li></ul></li><li>\u6B64\u5916\uFF0C\u5982\u679C\u8C03\u7528\u8005\u7684\u7EBF\u7A0B\u88AB\u4E2D\u65AD\uFF0Cpark \u5C06\u8FD4\u56DE\uFF0C</li><li>\u652F\u6301\u8D85\u65F6\u7248\u672C\u3002</li><li>park \u65B9\u6CD5\u4E5F\u53EF\u4EE5\u5728\u4EFB\u4F55\u5176\u4ED6\u65F6\u95F4\u201C\u65E0\u7F18\u65E0\u6545\u201D\u5730\u8FD4\u56DE\uFF0C</li><li>\u56E0\u6B64\u901A\u5E38\u5FC5\u987B\u5728\u5FAA\u73AF\u4E2D\u8C03\u7528\uFF0C\u8BE5\u5FAA\u73AF\u5728\u8FD4\u56DE\u65F6\u91CD\u65B0\u68C0\u67E5\u6761\u4EF6\u3002 <ul><li>\u4ECE\u8FD9\u4E2A\u610F\u4E49\u4E0A\u8BF4\uFF0C<code>park</code> \u662F\u201C\u5FD9\u7B49\u5F85\u201D\u7684\u4F18\u5316\uFF0C\u4E0D\u4F1A\u6D6A\u8D39\u592A\u591A\u65F6\u95F4\uFF0C\u4F46\u5FC5\u987B\u4E0E <code>unpark()</code> \u5BF9\u624D\u80FD\u6709\u6548\u3002</li></ul></li><li>\u57FA\u4E8E <strong>UNSAFE</strong> \u7C7B \u5B9E\u73B0</li></ol><h3 id="\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528" aria-hidden="true">#</a> \u4F7F\u7528</h3><ul><li>\u5B9E\u73B0 \u5148\u8FDB\u5148\u51FA\u4E0D\u53EF\u91CD\u5165\u9501\u7C7B\uFF1A</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">class</span> <span class="token class-name">FIFOMutex</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AtomicBoolean</span> locked <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">&gt;</span></span> waiters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentLinkedQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// \u52A0\u9501</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">boolean</span> wasInterrupted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
     <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     waiters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token comment">// \u961F\u5934\u7EBF\u7A0B\u975E\u5F53\u524D\u7EBF\u7A0B || CAS \u4FEE\u6539\u539F\u5B50\u7C7B locked \u4E3A true \u5931\u8D25</span>
     <span class="token keyword">while</span> <span class="token punctuation">(</span>waiters<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> current <span class="token operator">||</span> <span class="token operator">!</span>locked<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u963B\u585E\u5F53\u524D\u7EBF\u7A0B</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// \u6E05\u7A7A\u4E2D\u65AD\u6807\u5FD7\u4F4D\uFF0C\u5FFD\u7565\u4E2D\u65AD</span>
         wasInterrupted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     waiters<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>wasInterrupted<span class="token punctuation">)</span>          <span class="token comment">// reassert interrupt status on exit</span>
       current<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// \u91CA\u653E\u9501</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     locked<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span>waiters<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5524\u9192\u961F\u5934\u7EBF\u7A0B</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_2-\u7C7B\u56FE" tabindex="-1"><a class="header-anchor" href="#_2-\u7C7B\u56FE" aria-hidden="true">#</a> 2. \u7C7B\u56FE</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockSupport</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">LockSupport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// \u79C1\u6709\u6784\u9020\u51FD\u6570\uFF0C\u65E0\u6CD5\u5B9E\u4F8B\u5316</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_3-\u5E38\u7528\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_3-\u5E38\u7528\u65B9\u6CD5" aria-hidden="true">#</a> 3. \u5E38\u7528\u65B9\u6CD5</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">// \u5982\u679C\u8BB8\u53EF\u53EF\u7528\uFF0C\u5219\u4F7F\u7528\u5B83\u5E76\u7ACB\u5373\u8FD4\u56DE\u8C03\u7528\uFF1B\u5426\u5219\uFF0C\u5F53\u524D\u7EBF\u7A0B\u51FA\u4E8E\u7EBF\u7A0B\u8C03\u5EA6\u76EE\u7684\u800C\u88AB\u7981\u7528\u5E76\u5904\u4E8E\u4F11\u7720\u72B6\u6001\uFF0C\u76F4\u5230\u53D1\u751F\u4EE5\u4E0B\u4E09\u79CD\u60C5\u51B5\u4E4B\u4E00\uFF1A </span>
    <span class="token comment">// 1. \u5176\u4ED6\u4E00\u4E9B\u7EBF\u7A0B\u4EE5\u5F53\u524D\u7EBF\u7A0B\u4E3A\u76EE\u6807\u8C03\u7528 unpark\uFF1B</span>
    <span class="token comment">// 2. \u5176\u4ED6\u4E00\u4E9B\u7EBF\u7A0B\u4E2D\u65AD\u5F53\u524D\u7EBF\u7A0B\uFF1B</span>
    <span class="token comment">// 3. \u865A\u5047\uFF08\u5373\u65E0\u7F18\u65E0\u6545\uFF09\u7684\u8C03\u7528\u8FD4\u56DE\u3002</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">park</span><span class="token punctuation">(</span><span class="token class-name">Object</span> blocker<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setBlocker</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> blocker<span class="token punctuation">)</span><span class="token punctuation">;</span>
        UNSAFE<span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setBlocker</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        UNSAFE<span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// \u5982\u679C\u8BB8\u53EF\u53EF\u7528\uFF0C\u5219\u4F7F\u7528\u5B83\u5E76\u7ACB\u5373\u8FD4\u56DE\u8C03\u7528\uFF1B\u5426\u5219\uFF0C\u5F53\u524D\u7EBF\u7A0B\u51FA\u4E8E\u7EBF\u7A0B\u8C03\u5EA6\u76EE\u7684\u800C\u88AB\u7981\u7528\u5E76\u5904\u4E8E\u4F11\u7720\u72B6\u6001\uFF0C\u76F4\u5230\u53D1\u751F\u4EE5\u4E0B\u56DB\u79CD\u60C5\u51B5\u4E4B\u4E00\uFF1A </span>
    <span class="token comment">// 1. \u5176\u4ED6\u4E00\u4E9B\u7EBF\u7A0B\u4EE5\u5F53\u524D\u7EBF\u7A0B\u4E3A\u76EE\u6807\u8C03\u7528 unpark\uFF1B</span>
    <span class="token comment">// 2. \u5176\u4ED6\u4E00\u4E9B\u7EBF\u7A0B\u4E2D\u65AD\u5F53\u524D\u7EBF\u7A0B\uFF1B</span>
    <span class="token comment">// 3. \u6307\u5B9A\u7684\u7B49\u5F85\u65F6\u95F4\u8FC7\u53BB\uFF1B</span>
    <span class="token comment">// 4. \u865A\u5047\uFF08\u5373\u65E0\u7F18\u65E0\u6545\uFF09\u7684\u8C03\u7528\u8FD4\u56DE\u3002</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">parkNanos</span><span class="token punctuation">(</span><span class="token keyword">long</span> nanos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nanos <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            UNSAFE<span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> nanos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">parkNanos</span><span class="token punctuation">(</span><span class="token class-name">Object</span> blocker<span class="token punctuation">,</span> <span class="token keyword">long</span> nanos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nanos <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setBlocker</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> blocker<span class="token punctuation">)</span><span class="token punctuation">;</span>
            UNSAFE<span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> nanos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setBlocker</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// \u5982\u679C\u8BB8\u53EF\u53EF\u7528\uFF0C\u5219\u4F7F\u7528\u5B83\u5E76\u7ACB\u5373\u8FD4\u56DE\u8C03\u7528\uFF1B\u5426\u5219\uFF0C\u5F53\u524D\u7EBF\u7A0B\u51FA\u4E8E\u7EBF\u7A0B\u8C03\u5EA6\u76EE\u7684\u800C\u88AB\u7981\u7528\u5E76\u5904\u4E8E\u4F11\u7720\u72B6\u6001\uFF0C\u76F4\u5230\u53D1\u751F\u4EE5\u4E0B\u56DB\u79CD\u60C5\u51B5\u4E4B\u4E00\uFF1A </span>
    <span class="token comment">// 1. \u5176\u4ED6\u4E00\u4E9B\u7EBF\u7A0B\u4EE5\u5F53\u524D\u7EBF\u7A0B\u4E3A\u76EE\u6807\u8C03\u7528 unpark\uFF1B</span>
    <span class="token comment">// 2. \u5176\u4ED6\u4E00\u4E9B\u7EBF\u7A0B\u4E2D\u65AD\u5F53\u524D\u7EBF\u7A0B\uFF1B</span>
    <span class="token comment">// 3. \u6307\u5B9A\u7684\u622A\u6B62\u65E5\u671F\u5DF2\u8FC7\uFF1B</span>
    <span class="token comment">// 4. \u865A\u5047\uFF08\u5373\u65E0\u7F18\u65E0\u6545\uFF09\u7684\u8C03\u7528\u8FD4\u56DE\u3002</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">parkUntil</span><span class="token punctuation">(</span><span class="token class-name">Object</span> blocker<span class="token punctuation">,</span> <span class="token keyword">long</span> deadline<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setBlocker</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> blocker<span class="token punctuation">)</span><span class="token punctuation">;</span>
        UNSAFE<span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> deadline<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setBlocker</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">parkUntil</span><span class="token punctuation">(</span><span class="token keyword">long</span> deadline<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        UNSAFE<span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> deadline<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setBlocker</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> t<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Even though volatile, hotspot doesn&#39;t need a write barrier here.</span>
        UNSAFE<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> parkBlockerOffset<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// \u5982\u679C\u7EBF\u7A0B\u5728 park \u4E0A\u88AB\u963B\u585E\uFF0C\u90A3\u4E48\u5B83\u5C06\u89E3\u9664\u963B\u585E\u3002\u5982\u679C\u7ED9\u5B9A\u7EBF\u7A0B\u5C1A\u672A\u542F\u52A8\uFF0C\u5219\u4E0D\u4FDD\u8BC1\u6B64\u64CD\u4F5C\u6709\u4EFB\u4F55\u6548\u679C\u3002</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">unpark</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> thread<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>thread <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            UNSAFE<span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ------------ UNSAFE \u7C7B ----------------</span>
    <span class="token comment">// Hotspot implementation via intrinsics API</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>Unsafe</span> UNSAFE<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> parkBlockerOffset<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> SEED<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> PROBE<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> SECONDARY<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            UNSAFE <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>Unsafe</span><span class="token punctuation">.</span><span class="token function">getUnsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> tk <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
            parkBlockerOffset <span class="token operator">=</span> UNSAFE<span class="token punctuation">.</span>objectFieldOffset
                <span class="token punctuation">(</span>tk<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">&quot;parkBlocker&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            SEED <span class="token operator">=</span> UNSAFE<span class="token punctuation">.</span>objectFieldOffset
                <span class="token punctuation">(</span>tk<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">&quot;threadLocalRandomSeed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            PROBE <span class="token operator">=</span> UNSAFE<span class="token punctuation">.</span>objectFieldOffset
                <span class="token punctuation">(</span>tk<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">&quot;threadLocalRandomProbe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            SECONDARY <span class="token operator">=</span> UNSAFE<span class="token punctuation">.</span>objectFieldOffset
                <span class="token punctuation">(</span>tk<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">&quot;threadLocalRandomSecondarySeed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,12),o=[e];function c(l,i){return s(),a("div",null,o)}var r=n(t,[["render",c],["__file","lockS.html.vue"]]);export{r as default};
